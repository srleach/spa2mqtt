# Jacuzzi (Encrypted Protocol)

The encrypted protocol is known to be used from around 2019 manufactured Jacuzzi boards. This may also be shared with some balboa boards.

## Message Types

There are only really two inbound message types we're going to care about for the time being.

### "C4" Types - Control / Status Update
These are thought to be emitted roughly once per second. 

|     	      | MK 	| LEN 	| CHN | MID | TYPE | PAYL[0] | PAYL[1] | PAYL[2] |  ...  | CHKSUM |  MK  |  	
|:----------:|:---:	|:---:	|:---:	|:---:|:----:|:-------:|:-------:|:-------:|:-----:|:------:|:----:|
| position 	 | 0 	| 1 	| 2 	| 3 	 | 4 	  |   5 	   |   6 	   |   7 	   | ... 	 |  9 	   | 10 |
|   raw 	    | 7E 	| 26 	| FF 	| AF  |  C4  |   BB    |   B7    |   BF    |  ...  |   0A   | 7E |

In order to decode these "encrypted" packets, the payload itself must be run through the xor method:

```python
    def xormsg(self, data):
        lst = []
        for i in range(0,len(data)-1,2):
                c = data[i]^data[i+1]^1
                lst.append(c)
        return lst
```

Only the payload of the packet (i.e from position 5, to len(-2) to allow for the checksum and close marker (7E) to be plaintext)

#### Known Good C4 Captures

Credit to HyperactiveJ for the working code here.

##### Pre-Decryption/XOR Decoding

```
7E 26 FF AF C4 F9 F5 FD FC F3 F7 8E 0A F2 F6 B9 F6 CB EA 69 ED A3 EE ED F5 E3 E2 C2 E0 56 E6 E5 A9 BA 9A D9 D8 DF B8 7E
7E 26 FF AF C4 36 3A 32 33 3C 38 41 C5 3D 39 76 39 04 25 A6 22 6C 21 22 3A 2C 2D 0D 2F 99 29 2A 66 75 55 16 17 10 E2 7E
7E 26 FF AF C4 F1 FD F5 F4 FB FF 86 02 FA FE B1 FE C3 E2 61 E5 AB E6 E5 FD EB EA CA E8 5E EE ED A1 B2 92 D1 D0 D7 7C 7E
7E 26 FF AF C4 03 0F 07 06 09 0D 74 F0 08 0C 43 0C 31 10 93 17 59 14 17 0F 19 18 38 1A AC 1C 1F 53 40 60 23 22 25 8D 7E
7E 26 FF AF C4 1E 12 1A 1B 14 10 69 ED 15 11 5E 11 2C 0D 8E 0A 44 09 0A 12 04 05 25 07 B1 01 02 4E 5D 7D 3E 3F 38 3F 7E
7E 26 FF AF C4 DB D7 DF DE D1 D5 AC 28 D0 D4 9B D4 E9 C8 4B CF 81 CC CF D7 C1 C0 E0 C2 74 C4 C7 8B 98 B8 FB FA FD 90 7E
7E 26 FF AF C4 B7 BB B3 B2 BD B9 C0 44 BC B8 F7 B8 85 A4 27 A3 ED A0 A3 BB AD AC 8C AE 18 A8 AB E7 F4 D4 97 96 91 1D 7E
7E 26 FF AF C4 93 9F 97 96 99 9D E4 60 98 9C D3 9C A1 80 03 87 C9 84 87 9F 89 88 A8 8A 3C 8C 8F C3 D0 F0 B3 B2 B5 66 7E
7E 26 FF AF C4 C4 C8 C0 C1 CE CA B3 37 CF CB 84 CB F6 D7 54 D0 9E D3 D0 C8 DE DF FF DD 6B DB D8 94 87 A7 E4 E5 E2 13 7E
7E 26 FF AF C4 17 1B 13 12 1D 19 60 E4 1C 18 57 18 25 04 87 03 4D 00 03 1B 0D 0C 2C 0E B8 08 0B 47 54 74 37 36 31 60 7E
7E 26 FF AF C4 9C 90 98 99 96 92 EB 6F 97 93 DC 93 AE 8F 0C 88 C6 8B 88 90 86 87 A7 85 33 83 80 CC DF FF BC BD BA 6A 7E
7E 26 FF AF C4 0E 02 0A 0B 04 00 79 FD 05 01 4E 01 3C 1D 9E 1A 54 19 1A 02 14 15 35 17 A1 11 12 5E 4D 6D 2E 2F 28 B0 7E
7E 26 FF AF C4 D6 DA D2 D3 DC D8 A1 25 DD D9 96 D9 E4 C5 46 C2 8C C1 C2 DA CC CD ED CF 79 C9 CA 86 95 B5 F6 F7 F0 AD 7E
7E 26 FF AF C4 E3 EF E7 E6 E9 ED 94 10 E8 EC A3 EC D1 F0 73 F7 B9 F4 F7 EF F9 F8 D8 FA 4C FC FF B3 A0 80 C3 C2 C5 C2 7E
7E 26 FF AF C4 76 7A 72 73 7C 78 01 85 7D 79 36 79 44 65 E6 62 2C 61 62 7A 6C 6D 4D 6F D9 69 6A 26 35 15 56 57 50 D0 7E
7E 26 FF AF C4 04 08 00 01 0E 0A 73 F7 0F 0B 44 0B 36 17 94 10 5E 13 10 08 1E 1F 3F 1D AB 1B 18 54 47 67 24 25 22 45 7E
7E 26 FF AF C4 0E 02 0A 0B 04 00 79 FD 05 01 4E 01 3C 1D 9E 1A 54 19 1A 02 14 15 35 17 A1 11 12 5E 4D 6D 2E 2F 28 B0 7E
7E 26 FF AF C4 49 45 4D 4C 43 47 3E BA 42 46 09 46 7B 5A D9 5D 13 5E 5D 45 53 52 72 50 E6 56 55 19 0A 2A 69 68 6F 4A 7E
```

##### Pre and Post decoding

Decoding is carried out using `self.xormsg(data[5:len(data)-2])`



```
-----
7E 26 FF AF C4 BB B7 BF BE B1 B5 CC 48 B0 B4 FB B4 89 A8 2B AF E1 AC AF B7 A1 A0 85 A2 14 A4 A7 EB F8 D8 9B 9A 9D D8 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 6E 62 6A 6B 64 60 19 9D 65 61 2E 61 5C 7D FE 7A 34 79 7A 62 74 75 50 77 C1 71 72 3E 2D 0D 4E 4F 48 F8 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 F7 FB F3 F2 FD F9 80 04 FC F8 B7 F8 C5 E4 67 E3 AD E0 E3 FB ED EC C9 EE 58 E8 EB A7 B4 94 D7 D6 D1 4C 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 8E 82 8A 8B 84 80 F9 7D 85 81 CE 81 BC 9D 1E 9A D4 99 9A 82 94 95 B0 97 21 91 92 DE CD ED AE AF A8 B7 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 2D 21 29 28 27 23 5A DE 26 22 6D 22 1F 3E BD 39 77 3A 39 21 37 36 13 34 82 32 31 7D 6E 4E 0D 0C 0B 60 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 4B 47 4F 4E 41 45 3C B8 40 44 0B 44 79 58 DB 5F 11 5C 5F 47 51 50 75 52 E4 54 57 1B 08 28 6B 6A 6D 18 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 B6 BA B2 B3 BC B8 C1 45 BD B9 F6 B9 84 A5 26 A2 EC A1 A2 BA AC AD 88 AF 19 A9 AA E6 F5 D5 96 97 90 E5 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 EC E0 E8 E9 E6 E2 9B 1F E7 E3 AC E3 DE FF 7C F8 B6 FB F8 E0 F6 F7 D2 F5 43 F3 F0 BC AF 8F CC CD CA AD 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 36 3A 32 33 3C 38 41 C5 3D 39 76 39 04 25 A6 22 6C 21 22 3A 2C 2D 08 2F 99 29 2A 66 75 55 16 17 10 81 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 26 2A 22 23 2C 28 51 D5 2D 29 66 29 14 35 B6 32 7C 31 32 2A 3C 3D 18 3F 89 39 3A 76 65 45 06 07 00 0E 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 4D 41 49 48 47 43 3A BE 46 42 0D 42 7F 5E DD 59 17 5A 59 41 57 56 73 54 E2 52 51 1D 0E 2E 6D 6C 6B 4B 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 1B 17 1F 1E 11 15 6C E8 10 14 5B 14 29 08 8B 0F 41 0C 0F 17 01 00 25 02 B4 04 07 4B 58 78 3B 3A 3D A5 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 52 5E 56 57 58 5C 25 A1 59 5D 12 5D 60 41 C2 46 08 45 46 5E 48 49 6C 4B FD 4D 4E 02 11 31 72 73 74 C8 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 41 4D 45 44 4B 4F 36 B2 4A 4E 01 4E 73 52 D1 55 1B 56 55 4D 5B 5A 7F 58 EE 5E 5D 11 02 22 61 60 67 ED 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 B2 BE B6 B7 B8 BC C5 41 B9 BD F2 BD 80 A1 22 A6 E8 A5 A6 BE A8 A9 8C AB 1D AD AE E2 F1 D1 92 93 94 87 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 69 65 6D 6C 63 67 1E 9A 62 66 29 66 5B 7A F9 7D 33 7E 7D 65 73 72 57 70 C6 76 75 39 2A 0A 49 48 4F 30 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 2A 26 2E 2F 20 24 5D D9 21 25 6A 25 18 39 BA 3E 70 3D 3E 26 30 31 14 33 85 35 36 7A 69 49 0A 0B 0C A8 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 BE B2 BA BB B4 B0 C9 4D B5 B1 FE B1 8C AD 2E AA E4 A9 AA B2 A4 A5 80 A7 11 A1 A2 EE FD DD 9E 9F 98 21 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 52 5E 56 57 58 5C 25 A1 59 5D 12 5D 60 41 C2 46 08 45 46 5E 48 49 6C 4B FD 4D 4E 02 11 31 72 73 74 C8 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 2B 27 2F 2E 21 25 5C D8 20 24 6B 24 19 38 BB 3F 71 3C 3F 27 31 30 15 32 84 34 37 7B 68 48 0B 0A 0D 33 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 D1 DD D5 D4 DB DF A6 22 DA DE 91 DE E3 C2 41 C5 8B C6 C5 DD CB CA EF C8 7E CE CD 81 92 B2 F1 F0 F7 06 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 69 65 6D 6C 63 67 1E 9A 62 66 29 66 5B 7A F9 7D 33 7E 7D 65 73 72 57 70 C6 76 75 39 2A 0A 49 48 4F 30 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 2E 22 2A 2B 24 20 59 DD 25 21 6E 21 1C 3D BE 3A 74 39 3A 22 34 35 10 37 81 31 32 7E 6D 4D 0E 0F 08 CA 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 CE C2 CA CB C4 C0 B9 3D C5 C1 8E C1 FC DD 5E DA 94 D9 DA C2 D4 D5 F0 D7 61 D1 D2 9E 8D AD EE EF E8 85 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 F6 FA F2 F3 FC F8 81 05 FD F9 B6 F9 C4 E5 66 E2 AC E1 E2 FA EC ED C8 EF 59 E9 EA A6 B5 95 D6 D7 D0 D7 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 B1 BD B5 B4 BB BF C6 42 BA BE F1 BE 83 A2 21 A5 EB A6 A5 BD AB AA 8F A8 1E AE AD E1 F2 D2 91 90 97 2D 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 DC D0 D8 D9 D6 D2 AB 2F D7 D3 9C D3 EE CF 4C C8 86 CB C8 D0 C6 C7 E2 C5 73 C3 C0 8C 9F BF FC FD FA 3B 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 34 38 30 31 3E 3A 43 C7 3F 3B 74 3B 06 27 A4 20 6E 23 20 38 2E 2F 0A 2D 9B 2B 28 64 77 57 14 15 12 B0 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 53 5F 57 56 59 5D 24 A0 58 5C 13 5C 61 40 C3 47 09 44 47 5F 49 48 6D 4A FC 4C 4F 03 10 30 73 72 75 53 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 8F 83 8B 8A 85 81 F8 7C 84 80 CF 80 BD 9C 1F 9B D5 98 9B 83 95 94 B1 96 20 90 93 DF CC EC AF AE A9 2C 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 CF C3 CB CA C5 C1 B8 3C C4 C0 8F C0 FD DC 5F DB 95 D8 DB C3 D5 D4 F1 D6 60 D0 D3 9F 8C AC EF EE E9 1E 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 22 2E 26 27 28 2C 55 D1 29 2D 62 2D 10 31 B2 36 78 35 36 2E 38 39 1C 3B 8D 3D 3E 72 61 41 02 03 04 6C 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 4E 42 4A 4B 44 40 39 BD 45 41 0E 41 7C 5D DE 5A 14 59 5A 42 54 55 70 57 E1 51 52 1E 0D 2D 6E 6F 68 E1 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 4D 41 49 48 47 43 3A BE 46 42 0D 42 7F 5E DD 59 17 5A 59 41 57 56 73 54 E2 52 51 1D 0E 2E 6D 6C 6B 4B 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 A2 AE A6 A7 A8 AC D5 51 A9 AD E2 AD 90 B1 32 B6 F8 B5 B6 AE B8 B9 9C BB 0D BD BE F2 E1 C1 82 83 84 08 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
-----
7E 26 FF AF C4 65 69 61 60 6F 6B 12 96 6E 6A 25 6A 57 76 F5 71 3F 72 71 69 7F 7E 5B 7C CA 7A 79 35 26 06 45 44 43 96 7E
0D 00 05 85 05 4E 20 85 4C 19 00 26 B1 4D 21 00
```
